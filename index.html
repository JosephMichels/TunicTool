<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<style>

.main-line{
    stroke:rgb(150,150,150);
	stroke-dasharray:10;
}

.main-line.selected{
    stroke:rgb(30,30,30);
	stroke-width:3;
	stroke-dasharray:unset;
}

.line-group:hover .main-line{
    stroke-dasharray:unset;
	stroke-width:5;
	stroke:black;
}

.order-circle{
	stroke:rgb(150,150,150);
	stroke-dasharray:4;
	fill-opacity:0.0;
}

.order-circle.selected{
	stroke:rgb(30,30,30);
	stroke-width:3;
	stroke-dasharray:unset;
	fill-opacity:0.0;
}

.order-circle:hover {
	stroke:black;
	stroke-width:5;
	stroke-dasharray:unset;
}

.centered{
	line-height:28px;
	vertical-align:top;
	display:inline-block;
}

.glyph-sound{
	border: black 1px solid;
}


</style>
</head>
<body style="text-align:center;">
<img id="glyph-image" src="segments.png" style="display:none"/>
<h1>Tunic Tool</h1>
<div style="dispay:block; margin-top:-14px">
	<div style="width:400px;display:inline-block">
		<span>Simple tool for helping interperate some of the glyphs withing the game Tunic. Built on the work of reddit user <a href='https://www.reddit.com/user/oposdeo'>oposdeo</a> in this <a href='https://www.reddit.com/r/TunicGame/comments/tgc056/tunic_language_reference_sheet_big_spoiler/'>post</a>.</span>
	</div>
</div>
<br>
<svg width="400" height="400">
	<defs>
		<line id="line-01" x1="300" y1="100" x2="200" y2="50"/>
		<line id="line-02" x1="200" y1="50" x2="100" y2="100"/>
		<line id="line-03" x1="100" y1="100" x2="100" y2="300"/>
		<line id="line-04" x1="100" y1="300" x2="200" y2="350"/>
		<line id="line-05" x1="200" y1="350" x2="300" y2="300"/>

		<line id="line-06" x1="200" y1="150" x2="300" y2="100"/>
		<line id="line-07" x1="200" y1="150" x2="200" y2="50"/>
		<line id="line-08" x1="200" y1="150" x2="100" y2="100"/>
		<line id="line-09" x1="200" y1="150" x2="200" y2="200"/>
		<line id="line-10" x1="200" y1="250" x2="100" y2="300"/>
		<line id="line-11" x1="200" y1="250" x2="200" y2="350"/>
		<line id="line-12" x1="200" y1="250" x2="300" y2="300"/>

	</defs>


  <rect width="400" height="400" style="fill:rgb(220,220,220);stroke-width:1;stroke:rgb(0,0,0)" />

  <g id="line-01-g" class="line-group">
	<use xlink:href="#line-01" stroke-width="20" pointer-events="stroke"/>
	<use xlink:href="#line-01" class="main-line" data-segment="1"/>
  </g>
  <g id="line-02-g" class="line-group">
	<use xlink:href="#line-02" stroke-width="20" pointer-events="stroke"/>
	<use xlink:href="#line-02" class="main-line" data-segment="2"/>
  </g>
  <g id="line-03-g" class="line-group">
	<use xlink:href="#line-03" stroke-width="20" pointer-events="stroke"/>
	<use xlink:href="#line-03" class="main-line" data-segment="3"/>
  </g>
  <g id="line-04-g" class="line-group">
	<use xlink:href="#line-04" stroke-width="20" pointer-events="stroke"/>
	<use xlink:href="#line-04" class="main-line" data-segment="4"/>
  </g>
  <g id="line-05-g" class="line-group">
	<use xlink:href="#line-05" stroke-width="20" pointer-events="stroke"/>
	<use xlink:href="#line-05" class="main-line" data-segment="5"/>
  </g>
    <g id="line-06-g" class="line-group">
	<use xlink:href="#line-06" stroke-width="20" pointer-events="stroke"/>
	<use xlink:href="#line-06" class="main-line" data-segment="6"/>
  </g>
  <g id="line-07-g" class="line-group">
	<use xlink:href="#line-07" stroke-width="20" pointer-events="stroke"/>
	<use xlink:href="#line-07" class="main-line" data-segment="7"/>
  </g>
  <g id="line-08-g" class="line-group">
	<use xlink:href="#line-08" stroke-width="20" pointer-events="stroke"/>
	<use xlink:href="#line-08" class="main-line" data-segment="8"/>
  </g>
  <g id="line-09-g" class="line-group">
	<use xlink:href="#line-09" stroke-width="20" pointer-events="stroke"/>
	<use xlink:href="#line-09" class="main-line" data-segment="9"/>
  </g>
  <g id="line-10-g" class="line-group">
	<use xlink:href="#line-10" stroke-width="20" pointer-events="stroke"/>
	<use xlink:href="#line-10" class="main-line" data-segment="10"/>
  </g>
  <g id="line-11-g" class="line-group">
	<use xlink:href="#line-11" stroke-width="20" pointer-events="stroke"/>
	<use xlink:href="#line-11" class="main-line" data-segment="11"/>
  </g>
  <g id="line-12-g" class="line-group">
	<use xlink:href="#line-12" stroke-width="20" pointer-events="stroke"/>
	<use xlink:href="#line-12" class="main-line" data-segment="12"/>
  </g>


    <!-- Top Points -->
  <circle class="point" cx="200" cy="50" r="5"/>
  <circle class="point" cx="200" cy="150" r="5"/>
  <circle class="point" cx="100" cy="100" r="5"/>
  <circle class="point" cx="300" cy="100" r="5"/>

  <!-- Bottom Points -->
  <circle class="point" cx="200" cy="250" r="5"/>
  <circle class="point" cx="200" cy="350" r="5"/>
  <circle class="point" cx="100" cy="300" r="5"/>
  <circle class="point" cx="300" cy="300" r="5"/>

  <circle class="order-circle" cx="200" cy="375" r="10" data-segment="13"/>

  <line class="word-line" x1="40" y1="200" x2="360" y2="200" stroke="black" stroke-width="3"/>

</svg>
<div style="height:40px;margin-top:10px">
    <span class="centered" style="margin-right:4px;">Glyph:</span>
	<canvas style="image-rendering: pixelated; image-rendering: crisp-edges;" id="glyph-canvas" width="26" height="40"></canvas>
	<span class="centered" style="margin-right:4px;">Sound:</span>
	<div id="sound-container" style="display:inline-block;vertical-align:top;">
		<div class="glyph-sound" style="display:inline-block;width:100px;text-align: center;vertical-align: top;">
			<div style="display: inline-block;width:40%;text-align: center;vertical-align: top;">
				<span class="sample-sound-1">--</span>
				<br>
				<span class="sample-example-1" style="font-size: 13px;">--</span>
			</div>
			<span class="centered">+</span>
			<div style="display: inline-block;width:40%;text-align: center;vertical-align: top;">
				<span class="sample-sound-2">--</span>
				<br>
				<span class="sample-example-2" style="font-size: 13px;">--</span>
			</div>
		</div>
	</div>
	<span class="centered" style="margin-right:10px;margin-left:4px">Value:</span>
	<span class="centered" id="glyph-value" style="margin-right:10px;min-width:40px"></span>
</div>
<div style="height:40px;margin-top:10px">
    <span class="centered" style="margin-right:4px;">Known Glyph:</span>
	<span id="known-glyph" class="centered" style="margin-right:4px;">???</span>
</div>
<input id="add-to-word-button" type="button" value="Add to Word"/>
<input id="clear-glyph-button" type="button" value="Clear Glyph"/>
<input type="button" value="Clear Word"/>
<br/>
<br/>
<canvas id="word-canvas" style="image-rendering: pixelated; image-rendering: crisp-edges;background:rgb(225,225,225);" width="400" height="40"></canvas>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>

var vowelMapping =
{
    1:["IE","as in Guy"],
	2:["AY","as in Bay"],
	3:["EH","as in The"],
	4:null,
	5:null,
	6:["AH","as in Swan"],
	7:["A","as in Glass"],
	8:["OI","as in Toy"],
	9:null,
	10:null,
	11:null,
	12:["OU","as in Wolf"],
	13:null,
	14:null,
	15:["OO","as in Too"],
	16:["OW","as in How"],
	17:null,
	18:null,
	19:null,
	20:["ERE","as in Air"],
	21:null,
	22:["EER","as in Beer"],
	23:["ORE","as in Your"],
	24:["I","as in Bit"],
	25:null,
	26:null,
	27:["AR","as in Arm"],
	28:["E","as in End"],
	29:["IR","as in Bird"],
	30:["EE","as in Bee"],
	31:["OH","as in Toe"]
};

var conMapping = {
	5:["W","as in Wit"],
	26:["J","as in Jam"],
	41:["P","as in Poppy"],
	42:["L","as in Live"],
	43:["R","as in Run"],
	44:["CH","as in Chat"],
	45:["T","as in Tunic"],
	46:["Y","as in You"],
	47:["TH","as in Thick"],
	57:["F","as in Fox"],
	59:["S","as in Sit"],
	74:["B","as in Baby"],
	75:["K","as in Kart"],
	78:["V","as in Vine"],
	80:["M","as in Man"],
	84:["N","as in Net"],
	90:["D","as in Dog"],
	95:["ZH","as in Azure"],
	105:["G","as in Gun"],
	110:["Z","as in Zit"],
	114:["H","as in Hop"],
	122:["TH","as in This"],
	125:["SH","as in Shut"],
	127:["NG","as in Rink"],
}

var knownWords = {
    "7640":"is",
	"3":"a",
	"3928+1888":"this",
	"23":"or",
	"1455":"to",
	"2583":"more",
}

$( document ).ready(function() {
  //Attach handlers for clicked lines
  $(".line-group").click((e) => {
	$elem = $(e.currentTarget).find(".main-line");
	if($elem.hasClass("selected")){
	    $elem.removeClass("selected");
	}else{
	    $elem.addClass("selected");
	}
	drawSample()
  });

    $(".order-circle").click((e) => {
	$elem = $(e.currentTarget);
	if($elem.hasClass("selected")){
	    $elem.removeClass("selected");
	}else{
	    $elem.addClass("selected");
	}
	drawSample()
  });

  var scale = 1;
  var image = $('#glyph-image')[0];
  var canvas = $('#glyph-canvas')[0];
  var ctx = canvas.getContext('2d');
  ctx.imageSmoothingEnabled= false

  function drawSample(){
	var glyph = 0;
	var segments = $('.selected').each(function(){
		glyph += 1 << ($(this).data('segment') - 1);
	});
	clearCanvas(canvas, ctx);
	drawGlyph(ctx, glyph, 4,0,scale);
	$('#glyph-value').text(glyph);

	var $soundRoot = $('#sound-container');
	var sampleSound1 = $soundRoot.find('.sample-sound-1');
	var sampleSound2 = $soundRoot.find('.sample-sound-2');
	var example1 = $soundRoot.find('.sample-example-1');
	var example2 = $soundRoot.find('.sample-example-2');

	var flipped = (glyph & (1<<12)) > 0;
	if(flipped){
	    var t = sampleSound1;
		sampleSound1 = sampleSound2;
		sampleSound2 = t;
		var t2 = example1;
		example1 = example2;
		example2 = t2;
	}

	var vowel = glyph & 31
	if(vowelMapping[vowel] != null){
		//update vowel sound
		sampleSound2.text(vowelMapping[vowel][0]);
		example2.text(vowelMapping[vowel][1]);
	}else{
		sampleSound2.text('--');
		example2.text('--');
	}
	
	var con = (glyph & (4064)) >> 5;
	if(conMapping[con] !== undefined){
		//update con sound
		sampleSound1.text(conMapping[con][0]);
		example1.text(conMapping[con][1]);
	}else{
		sampleSound1.text('--');
		example1.text('--');
	}
	
  }

  function clearCanvas(canvas, ctx){
      ctx.clearRect(0,0,canvas.width, canvas.height);
  }

  function drawSegment(ctx, index, x, y, scale){
	ctx.drawImage(image, 19*index,0,19,29,x,y,scale*19,scale*29);
  }

  function drawWordline(ctx, x, y, scale){
   ctx.drawImage(image, 19*13,0,21,29,x-scale,y,scale*21,scale*29);
  }

  function drawGlyph(ctx, glyph, x, y, scale){
	  for(let i=0;i<13;i++){
		if(glyph & (1 << i)) drawSegment(ctx,i,x,y,scale);
	  }
	  drawWordline(ctx,x,y,scale);
  }

  function drawWord(ctx, glyphs, x, y, scale){
      for(var i=0;i<glyphs.length;i++){
		drawGlyph(ctx, glyphs[i], x + (18 * i * scale), y, scale);
	  }
  }

  var currentWord = [];
  var wordCanvas = $('#word-canvas')[0];
  var wordContext = wordCanvas.getContext('2d');
  wordContext.imageSmoothingEnabled= false;

  $('#add-to-word-button').click((e)=>{
	currentWord.push($('#glyph-value').text());
	clearCanvas(wordCanvas,wordContext);
	drawWord(wordContext, currentWord, 5, 6, 1);
  });
  
  $('#clear-glyph-button').click((e)=>{
	$('.selected').removeClass('selected');
	drawSample();
  });

});

</script>
</html>